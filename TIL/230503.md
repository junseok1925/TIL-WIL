## ì˜¤ëŠ˜ í•´ì•¼í•  ê²ƒ âœ…

- https://github.com/junseok1925/Board_Sequelize â†’ ì¢‹ì•„ìš” APIêµ¬í˜„

## ê²Œì‹œê¸€ì— ì¢‹ì•„ìš” ë“±ë¡,ì·¨ì†Œ api

```jsx
router.post("/posts/:postId/like", authMiddleware, async (req, res) => {
  try {
	  // í˜„ì¬ localsì— ì €ì¥ëœ userId = ë¡œê·¸ì¸ëœ ìœ ì €
    const { userId } = res.locals.user;
    const { postId } = req.params;
		
		// ê¸°ë³¸í‚¤(primary key)ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ì„ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œ
    // Posts ëª¨ë¸ì—ì„œ postIdê°€ ê¸°ë³¸í‚¤ì¼ ê²½ìš° postIdë¥¼ ê°€ì§„ ê²Œì‹œë¬¼ ë°ì´í„°ë¥¼ ì¡°íšŒ
    const post = await Posts.findByPk(postId);
    if (!post) {
      return res.status(404).json({ message: "ê²Œì‹œë¬¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." });
    }
		// ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ëŠ”ì§€ í™•ì¸í•˜ê¸°ìœ„í•´
		// Likesëª¨ë¸ì— í•´ë‹¹ postIdì™€ userIdê°€ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ ë¦¬í„´
    const likeFn = await Likes.findOne({
      where: { postId: postId, userId: userId },
    });
		
    if (!likeFn) {
			//likeFnì— postIdì™€ userIdê°€ ê°™ì€ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë“±ë¡
      await Likes.create({ postId: postId, userId: userId });
      res.status(200).json({ message: "ê²Œì‹œê¸€ì˜ ì¢‹ì•„ìš”ë¥¼ ë“±ë¡í•˜ì˜€ìŠµë‹ˆë‹¤." });
    } else {
      await likeFn.destroy();
      res.status(200).json({ message: "ê²Œì‹œê¸€ì˜ ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí•˜ì˜€ìŠµë‹ˆë‹¤." });
    }
  } catch (error) {
    console.error(error);
    res.status(400).json({ message: "ê²Œì‹œê¸€ ì¢‹ì•„ìš”ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤." });
  }
```

## ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ ì¡°íšŒ

```jsx
// ========================= ì¢‹ì•„ìš” ê²Œì‹œë¬¼ ì¡°íšŒ =========================
router.get("/posts/like", authMiddleware, async (req, res) => {
  try {
    const { userId } = res.locals.user;
    //userIdê°€ ì§€ê¸ˆ localsì— ì €ì¥ëœ(ë¡œê·¸ì¸ëœ) userIdì™€ ê°™ì€ ê°’ì„ ê°€ì§„ Likesë°ì´í„°ë¥¼ ì €ì¥
    const likes = await Likes.findAll({ where: { userId } });
  
    if (!likes) {
      res.status(400).json({ message: "ì¢‹ì•„ìš” ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." });
    }
		// likePostsì—ëŠ” í•´ë‹¹ userIdì˜ ëª¨ë“  ì¢‹ì•„ìš” ë°ì´í„°ê°€ ì €ì¥
    // ê° ë°ì´í„°ëŠ” postIdë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, 
    // Posts ëª¨ë¸ê³¼ inner joiní•˜ì—¬ postIdì— í•´ë‹¹í•˜ëŠ” Posts ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤
    // likePostsì—ëŠ” í˜„ì¬ ë¡œê·¸ì¸ëœ userIdê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²Œì‹œë¬¼ì˜ postIdë¥¼ ê°€ì ¸ì˜¤ê³ ,
    // ì´ postIdë¥¼ ê°€ì§„ ê²Œì‹œë¬¼ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ
    const likePosts = await Likes.findAll({
      attributes: ["postId"], // ì¡°íšŒê²°ê³¼ì—ì„œ ê°€ì ¸ì˜¬ ì†ì„± ('postId')
      include: [
        {
          model: Posts, // Posts ëª¨ë¸ì„ ì¡°ì¸
          required: true,
          attributes:['postId','userId','nickname','title','createdAt','updatedAt','likes'], // "content"ì»¬ëŸ¼ê°’ë§Œ ë¹¼ê³  ê°€ì ¸ì˜´
        },
      ],
      where: { userId }, //localsì˜ userIdê°€ ê°™ì€ userIdë¥¼ ê°€ì§„ ë°ì´í„°ë§Œ ë½‘ì•„ì˜¨ë‹¤
    });

    // likePostsë°°ì—´ì˜ ê°ì²´ë¥¼ ì´ìš©í•´ postsë°°ì—´ì„ ìƒì„±
    // ikePostsëŠ” í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ Posts ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„,
		//í•´ë‹¹ ë°ì´í„°ë¥¼ ê°€ì§„ Likes í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ì¡°íšŒí•œ ê²°ê³¼
		//ë”°ë¼ì„œ likePostsì—ëŠ” í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ Posts ë°ì´í„°ì™€ Likes í…Œì´ë¸”ì˜ ì •ë³´ê°€ ëª¨ë‘ ë‹´ê²¨ìˆë‹¤
    const postsLiked = likePosts.map((post) => {
		// likePostsë°°ì—´ì„ ìˆœíšŒí•˜ë©´ì„œ postLikedì— ê°ì²´ë¥¼ ì¶”ê°€
		// postëŠ” likePosts ë°°ì—´ì˜ ê° ìš”ì†Œë¥¼ ë‹´ì•„ì ¸ìˆë‹¤
      return {
        postId: post.postId,
        userId: post.Post.userId,
        nickname: post.Post.nickname,
        title: post.Post.title,
        likes: post.Post.likes,
        createdAt: post.Post.createdAt,
        updatedAt: post.Post.updatedAt,
      };
    });

    return res.status(200).json({ postsLiked });
  } catch (error) {
    console.error(error);
    res.status(400).json({ message: "ê²Œì‹œê¸€ ì¢‹ì•„ìš”ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤." });
  }
});
```

## ì˜¤ë¥˜ ë‚´ìš©

[localhost:3003/api/posts/like](http://localhost:3003/api/posts/like) â†’ í•´ë‹¹ ì£¼ì†Œê°€ ì˜ëª»ëœ ì£¼ì†Œë¡œ ì¸ì‹ë¨

/api/posts/:postId â†’ ê²Œì‹œë¬¼ ìƒì„¸ ì¡°íšŒ ì£¼ì†Œì¸ë°  ìœ„ì— ì£¼ì†Œì—ì„œ likeë¥¼ postIdë¡œ ì¸ì‹, ì˜ëª»ëœ postIdë¥¼ ì…ë ¥í•œ ê²ƒì´ë¼ ì¸ì‹í•´ì„œ ì˜¤ë¥˜ê°€ ëœ¸

```jsx
app.use('/api', usersRouter);
app.use('/api', likesRouter);
app.use('/api', postsRouter);
app.use('/api', commentsRouter);
```

app.use ì—ì„œ ìš°ì„ ìˆœìœ„ ìœ„ì¹˜ë¥¼ ë°”ê¿”ì¤Œ

## GitHub ğŸ“˜

- https://github.com/junseok1925/Board_Sequelize
- https://github.com/junseok1925/TIL-WIL